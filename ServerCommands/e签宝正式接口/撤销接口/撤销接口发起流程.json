{
  "Name": "撤销接口发起流程",
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.ServerCommands.Models.PostRequestTrigger, ServerDesignerCommon",
      "Permission": {
        "PermissionData": {
          "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionData, Forguncy.RbacPermission.Core",
          "permissionResource": {
            "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionResource, Forguncy.RbacPermission.Core"
          },
          "permissionBindings": [
            {
              "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionBinding, Forguncy.RbacPermission.Core",
              "roleNames": [
                "FGC_LoginUser",
                "Administrator"
              ]
            }
          ]
        }
      },
      "HttpMethod": 3,
      "Parameters": [
        {
          "Name": "流程ID",
          "TestData": "fd5e163fdde74b54bf599bceafbc6505"
        }
      ],
      "InvokeTriggerTestData": {
        "UserName": "Administrator"
      }
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.ServerTransactionCommand, ServerDesignerCommon",
      "CommandList": [
        {
          "$type": "Forguncy.Model.CatchExceptionCommand, ServerDesignerCommon",
          "TryCommandPart": {
            "CommandList": [
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "token",
                "TableValue": {
                  "TableName": "token",
                  "OnlyGetValue": true,
                  "TableValueType": 0,
                  "BindingInfos": [
                    {
                      "BindingInfo": {
                        "TableName": "token",
                        "ColumnName": "token",
                        "GUID": "8a7f28c4-6dfe-4034-9b52-54d7ea17c2a5"
                      },
                      "ColumnName": "token"
                    }
                  ]
                },
                "ID": "1ceef6407a7d4998b9b374c1dbd17f07"
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "获取撤销流程前缀",
                "ParameterValue": "https://openapi.esign.cn/v3/sign-flow/",
                "ID": "67a7eaf3ae5e467e86917056eae2dfb3"
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "获取流程ID",
                "ParameterValue": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=流程ID"
                },
                "ID": "62f3ed3fcb0e4867a9c4215bf1728f7e"
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "获取撤销流程后缀",
                "ParameterValue": "/revoke",
                "ID": "81e0ae35d76e4f17908fd5958a5e6272"
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "拼接成完整接口地址",
                "ParameterValue": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=获取撤销流程前缀&获取流程ID&获取撤销流程后缀"
                },
                "ID": "5811f77524434b319eb43845e0307c77"
              },
              {
                "$type": "PostDataToWebApi.PostDataCommand, PostDataToWebApi",
                "PostData": {
                  "DataItemType": 1,
                  "Data": {
                    "$type": "PostDataToWebApi.ObjectData, PostDataToWebApi",
                    "IsStringify": true,
                    "Data": [
                      {
                        "Name": "revokeReason",
                        "DataItemType": 0,
                        "Data": "修改签章"
                      }
                    ]
                  }
                },
                "WebUrl": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=拼接成完整接口地址"
                },
                "Method": "POST",
                "SuccessCallback": "// 请求成功返回的数据存储在“result”变量中\r\n// 请使用“result”变量来完成请求成功的回调 \r\n//console.log(result);",
                "ErrorCallback": "// 请求中发生的错误存储在“error”变量中\r\n// 请使用“error”变量来处理异常情况 \r\nconsole.error(error);",
                "NewParameter": "撤销data",
                "Header": [
                  {
                    "Type": "X-Tsign-Open-App-Id",
                    "Value": "5111834261"
                  },
                  {
                    "Type": "X-Tsign-Open-Token",
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=token"
                    }
                  },
                  {
                    "Type": "Content-Type",
                    "Value": "application/json"
                  }
                ],
                "Timeout": 100.0
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "查询连接",
                "ParameterValue": "https://openapi.esign.cn/v3/sign-flow/",
                "ID": "4f924a4a10c342ed9be460dc5fb45fee"
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "流程查询地址",
                "ParameterValue": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=查询连接&获取流程ID"
                },
                "ID": "432eb07b207146a0996a7d5136232f0b"
              },
              {
                "$type": "PostDataToWebApi.PostDataCommand, PostDataToWebApi",
                "PostData": {
                  "DataItemType": 1,
                  "Data": {
                    "$type": "PostDataToWebApi.ObjectData, PostDataToWebApi",
                    "Data": []
                  }
                },
                "WebUrl": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=流程查询地址"
                },
                "Method": "GET",
                "SuccessCallback": "// 请求成功返回的数据存储在“result”变量中\r\n// 请使用“result”变量来完成请求成功的回调 \r\n//console.log(result);",
                "ErrorCallback": "// 请求中发生的错误存储在“error”变量中\r\n// 请使用“error”变量来处理异常情况 \r\nconsole.error(error);",
                "NewParameter": "流程状态",
                "Header": [
                  {
                    "Type": "X-Tsign-Open-App-Id",
                    "Value": "5111834261"
                  },
                  {
                    "Type": "X-Tsign-Open-Token",
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=token"
                    }
                  },
                  {
                    "Type": "Content-Type",
                    "Value": "application/json"
                  }
                ],
                "Timeout": 100.0
              },
              {
                "$type": "GETPOST.JSON类.JSON取通用属性, GETPOST",
                "BianmaMsg": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=流程状态"
                },
                "JsonLu": "data",
                "Noobj": true,
                "FanHuiMsg": "流程状态data"
              },
              {
                "$type": "GETPOST.JSON类.JSON取通用属性, GETPOST",
                "BianmaMsg": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=流程状态data"
                },
                "JsonLu": "signFlowStatus",
                "FanHuiMsg": "signFlowStatus"
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "销售合同",
                "TableValue": {
                  "TableName": "合同模板主表",
                  "TableValueType": 3,
                  "SqlCondition": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "合同模板主表",
                      "ColumnName": "发起流程ID",
                      "GUID": "e4af50db-55e9-46ff-b366-0ac8a79a9cf8"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=流程ID"
                    }
                  }
                },
                "ID": "63e8d1b1347347809ac1158fc4802dd7"
              },
              {
                "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                "ParameterName": "签章任务",
                "TableValue": {
                  "TableName": "签章任务",
                  "TableValueType": 3,
                  "SqlCondition": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "签章任务",
                      "ColumnName": "发起流程ID",
                      "GUID": "e772e9a4-6f27-44a4-8a72-17fc7a7f50bb"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=流程ID"
                    }
                  }
                },
                "ID": "49f22111c85a4cecac9d4594d6900af1"
              },
              {
                "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                "ConditionAndCommandPairList": [
                  {
                    "Condition": {
                      "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                      "param": {
                        "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                        "ParamObject": {
                          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                          "SerializeProperty": "=销售合同"
                        }
                      },
                      "value": "0",
                      "compareType": 1
                    },
                    "CommandList": [
                      {
                        "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                        "ParameterName": "查询合同",
                        "TableValue": {
                          "TableName": "合同模板主表",
                          "TableValueType": 1,
                          "BindingInfos": [
                            {
                              "BindingInfo": {
                                "TableName": "合同模板主表",
                                "ColumnName": "ID",
                                "GUID": "84a0c3d0-8197-48d5-954d-eba77a452517"
                              },
                              "ColumnName": "ID"
                            },
                            {
                              "BindingInfo": {
                                "TableName": "合同模板主表",
                                "ColumnName": "crm合同id",
                                "GUID": "8a1ca7b4-41d6-4d42-b12d-b822fd84e306"
                              },
                              "ColumnName": "crm合同id"
                            },
                            {
                              "BindingInfo": {
                                "TableName": "合同模板主表",
                                "ColumnName": "发起流程ID",
                                "GUID": "8244607e-e0a7-4fe4-9214-85e8fb6d7ed9"
                              },
                              "ColumnName": "发起流程ID"
                            }
                          ],
                          "SqlCondition": {
                            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                            "ColumnBindingInfo": {
                              "TableName": "合同模板主表",
                              "ColumnName": "发起流程ID",
                              "GUID": "3d6cb857-3a2b-4d27-ac64-c0b7d9fd169c"
                            },
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=流程ID"
                            }
                          }
                        },
                        "ID": "50c7c4bbe05d43d9b1ed74ba719f2437"
                      },
                      {
                        "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                        "TableName": "合同模板主表",
                        "ShowConfirm": false,
                        "RowsToUpdate": 1,
                        "RowsToUpdateCondition": {
                          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                          "ColumnBindingInfo": {
                            "TableName": "合同模板主表",
                            "ColumnName": "发起流程ID",
                            "GUID": "1b1573fe-8f33-4c45-b353-a41547abac1a"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=流程ID"
                          }
                        },
                        "UpdateBindingValues": [
                          {
                            "BindingInfo": {
                              "TableName": "合同模板主表",
                              "ColumnName": "接口状态",
                              "GUID": "b8204566-ced8-452a-a831-597135e3bb01"
                            },
                            "Value": "3"
                          }
                        ]
                      },
                      {
                        "$type": "PostDataToWebApi.PostDataCommand, PostDataToWebApi",
                        "PostData": {
                          "DataItemType": 1,
                          "Data": {
                            "$type": "PostDataToWebApi.ObjectData, PostDataToWebApi",
                            "IsStringify": true,
                            "Data": [
                              {
                                "Name": "param",
                                "DataItemType": 1,
                                "Data": {
                                  "$type": "PostDataToWebApi.ObjectData, PostDataToWebApi",
                                  "Data": [
                                    {
                                      "Name": "status",
                                      "DataItemType": 0,
                                      "Data": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=signFlowStatus"
                                      }
                                    },
                                    {
                                      "Name": "id",
                                      "DataItemType": 0,
                                      "Data": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=查询合同.crm合同id"
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "WebUrl": "http://221.1.80.188:32001/api/app.php?s=App.ApproveErpToCrm.ChangeStatus",
                        "Method": "POST",
                        "SuccessCallback": "// 请求成功返回的数据存储在“result”变量中\r\n// 请使用“result”变量来完成请求成功的回调 \r\n//console.log(result);",
                        "ErrorCallback": "// 请求中发生的错误存储在“error”变量中\r\n// 请使用“error”变量来处理异常情况 \r\nconsole.error(error);",
                        "Header": [],
                        "Timeout": 100.0
                      },
                      {
                        "$type": "GETPOST.JSON类.JSON取通用属性, GETPOST",
                        "BianmaMsg": {
                          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                          "SerializeProperty": "=撤销data"
                        },
                        "JsonLu": "code",
                        "FanHuiMsg": "code"
                      },
                      {
                        "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
                        "ErrorCode": "0",
                        "CustomReturns": [
                          {
                            "ReturnPropertyName": "返回值",
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=code"
                            }
                          }
                        ]
                      }
                    ],
                    "ID": "031657f4-c670-4527-9c93-cfced22d88a4"
                  },
                  {
                    "Condition": {
                      "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                      "param": {
                        "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                        "ParamObject": {
                          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                          "SerializeProperty": "=签章任务"
                        }
                      },
                      "value": "0",
                      "compareType": 1
                    },
                    "CommandList": [
                      {
                        "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                        "ParameterName": "查询签章ID",
                        "TableValue": {
                          "TableName": "签章任务",
                          "TableValueType": 1,
                          "BindingInfos": [
                            {
                              "BindingInfo": {
                                "TableName": "签章任务",
                                "ColumnName": "签章任务ID",
                                "GUID": "9e50e30f-fb2b-49a8-ba28-ac0528af6800"
                              },
                              "ColumnName": "签章任务ID"
                            },
                            {
                              "BindingInfo": {
                                "TableName": "签章任务",
                                "ColumnName": "crm单号",
                                "GUID": "d05a2183-f1cc-4276-900b-01f267cef8aa"
                              },
                              "ColumnName": "crm单号"
                            }
                          ],
                          "SqlCondition": {
                            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                            "ColumnBindingInfo": {
                              "TableName": "签章任务",
                              "ColumnName": "发起流程ID",
                              "GUID": "aeb9d48b-e5ab-412a-9ba5-fec1b88f8e14"
                            },
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=流程ID"
                            }
                          },
                          "TopCount": "1"
                        },
                        "ID": "666113647b28470b8e0be9f3f7957dc6"
                      },
                      {
                        "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                        "TableName": "签章任务",
                        "ShowConfirm": false,
                        "RowsToUpdate": 1,
                        "RowsToUpdateCondition": {
                          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                          "ColumnBindingInfo": {
                            "TableName": "签章任务",
                            "ColumnName": "签章任务ID",
                            "GUID": "0996deb8-39e3-450f-97d4-2e1dde012b45"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=查询签章ID.签章任务ID"
                          }
                        },
                        "UpdateBindingValues": [
                          {
                            "BindingInfo": {
                              "TableName": "签章任务",
                              "ColumnName": "接口发起状态",
                              "GUID": "779e1f60-4893-43ea-8b9f-01546947c7b4"
                            },
                            "Value": "3"
                          }
                        ]
                      },
                      {
                        "$type": "PostDataToWebApi.PostDataCommand, PostDataToWebApi",
                        "PostData": {
                          "DataItemType": 1,
                          "Data": {
                            "$type": "PostDataToWebApi.ObjectData, PostDataToWebApi",
                            "IsStringify": true,
                            "Data": [
                              {
                                "Name": "param",
                                "DataItemType": 1,
                                "Data": {
                                  "$type": "PostDataToWebApi.ObjectData, PostDataToWebApi",
                                  "Data": [
                                    {
                                      "Name": "status",
                                      "DataItemType": 0,
                                      "Data": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=signFlowStatus"
                                      }
                                    },
                                    {
                                      "Name": "fhdCode",
                                      "DataItemType": 0,
                                      "Data": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=查询签章ID.crm单号"
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "WebUrl": "http://221.1.80.188:32001/api/app.php?s=App.FhdErpToCrm.ChangeStatus",
                        "Method": "POST",
                        "SuccessCallback": "// 请求成功返回的数据存储在“result”变量中\r\n// 请使用“result”变量来完成请求成功的回调 \r\n//console.log(result);",
                        "ErrorCallback": "// 请求中发生的错误存储在“error”变量中\r\n// 请使用“error”变量来处理异常情况 \r\nconsole.error(error);",
                        "Header": [],
                        "Timeout": 100.0
                      },
                      {
                        "$type": "GETPOST.JSON类.JSON取通用属性, GETPOST",
                        "BianmaMsg": {
                          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                          "SerializeProperty": "=撤销data"
                        },
                        "JsonLu": "code",
                        "FanHuiMsg": "code"
                      },
                      {
                        "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
                        "ErrorCode": "0",
                        "CustomReturns": [
                          {
                            "ReturnPropertyName": "返回值",
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=code"
                            }
                          }
                        ]
                      }
                    ],
                    "ID": "4bc5973c-9d45-40f1-8f47-d7978b4fc448"
                  }
                ]
              }
            ]
          },
          "CatchCommandPart": {
            "CommandList": [
              {
                "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
                "ErrorCode": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=ExceptionCode"
                },
                "Message": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=ExceptionMessage"
                },
                "CustomReturns": [
                  {
                    "ReturnPropertyName": "返回值",
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=ExceptionMessage"
                    }
                  }
                ]
              }
            ]
          }
        }
      ]
    }
  ],
  "ReturnProperties": [
    {
      "Name": "返回值"
    }
  ]
}